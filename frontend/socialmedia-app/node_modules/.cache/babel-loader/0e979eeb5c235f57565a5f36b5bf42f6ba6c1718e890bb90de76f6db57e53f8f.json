{"ast":null,"code":"var _s = $RefreshSig$();\n// src/useWebSocket.js\nimport { useState, useEffect } from 'react';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport connectWebSocket from \"./websocket\";\nimport { updatePostComments, updatePostLikes } from \"./features/auth/feedSlice\";\nconst useWebSocket = () => {\n  _s();\n  const dispatch = useDispatch();\n  const token = useSelector(state => state.auth.token);\n  const [ws, setWs] = useState(null);\n  useEffect(() => {\n    const handleWebSocketConnection = () => {\n      const ws = connectWebSocket(token);\n      ws.onmessage = event => {\n        const data = JSON.parse(event.data);\n        if (data.type === 'LIKE_UPDATE') {\n          dispatch(updatePostLikes({\n            postId: data.postId,\n            likes: data.likes,\n            totalLikes: data.totalLikes\n          }));\n        } else if (data.type === 'COMMENT_UPDATE') {\n          dispatch(updatePostComments({\n            postId: data.postId,\n            comments: data.comments,\n            totalComments: data.totalComments\n          }));\n        }\n      };\n      ws.onclose = () => {\n        console.log('WebSocket connection closed');\n      };\n      ws.onerror = error => {\n        console.log('WebSocket error:', error);\n      };\n      setWs(ws);\n    };\n    handleWebSocketConnection();\n    return () => {\n      if (ws) {\n        ws.close();\n      }\n    };\n  }, [dispatch, token]);\n  return ws;\n};\n_s(useWebSocket, \"wNuMn4Lc7MyI47RP/ZU1RJ/YRvg=\", false, function () {\n  return [useDispatch, useSelector];\n});\nexport default useWebSocket;","map":{"version":3,"names":["useState","useEffect","useDispatch","useSelector","connectWebSocket","updatePostComments","updatePostLikes","useWebSocket","_s","dispatch","token","state","auth","ws","setWs","handleWebSocketConnection","onmessage","event","data","JSON","parse","type","postId","likes","totalLikes","comments","totalComments","onclose","console","log","onerror","error","close"],"sources":["H:/SecondProject-DjangoReact/frontend/socialmedia-app/src/handleWebSocket.js"],"sourcesContent":["// src/useWebSocket.js\r\nimport { useState, useEffect } from 'react';\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport connectWebSocket from \"./websocket\";\r\nimport { updatePostComments, updatePostLikes } from \"./features/auth/feedSlice\";\r\n\r\nconst useWebSocket = () => {\r\n  const dispatch = useDispatch();\r\n  const token = useSelector((state) => state.auth.token);\r\n  const [ws, setWs] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const handleWebSocketConnection = () => {\r\n      const ws = connectWebSocket(token);\r\n      ws.onmessage = (event) => {\r\n        const data = JSON.parse(event.data);\r\n        if (data.type === 'LIKE_UPDATE') {\r\n          dispatch(updatePostLikes({\r\n            postId: data.postId,\r\n            likes: data.likes,\r\n            totalLikes: data.totalLikes,\r\n          }));\r\n        } else if (data.type === 'COMMENT_UPDATE') {\r\n          dispatch(updatePostComments({\r\n            postId: data.postId,\r\n            comments: data.comments,\r\n            totalComments: data.totalComments,\r\n          }));\r\n        }\r\n      };\r\n      ws.onclose = () => {\r\n        console.log('WebSocket connection closed');\r\n      };\r\n      ws.onerror = (error) => {\r\n        console.log('WebSocket error:', error);\r\n      };\r\n      setWs(ws);\r\n    };\r\n\r\n    handleWebSocketConnection();\r\n\r\n    return () => {\r\n      if (ws) {\r\n        ws.close();\r\n      }\r\n    };\r\n  }, [dispatch, token]);\r\n\r\n  return ws;\r\n};\r\n\r\nexport default useWebSocket;"],"mappings":";AAAA;AACA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,SAASC,WAAW,EAAEC,WAAW,QAAQ,aAAa;AACtD,OAAOC,gBAAgB,MAAM,aAAa;AAC1C,SAASC,kBAAkB,EAAEC,eAAe,QAAQ,2BAA2B;AAE/E,MAAMC,YAAY,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACzB,MAAMC,QAAQ,GAAGP,WAAW,CAAC,CAAC;EAC9B,MAAMQ,KAAK,GAAGP,WAAW,CAAEQ,KAAK,IAAKA,KAAK,CAACC,IAAI,CAACF,KAAK,CAAC;EACtD,MAAM,CAACG,EAAE,EAAEC,KAAK,CAAC,GAAGd,QAAQ,CAAC,IAAI,CAAC;EAElCC,SAAS,CAAC,MAAM;IACd,MAAMc,yBAAyB,GAAGA,CAAA,KAAM;MACtC,MAAMF,EAAE,GAAGT,gBAAgB,CAACM,KAAK,CAAC;MAClCG,EAAE,CAACG,SAAS,GAAIC,KAAK,IAAK;QACxB,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACC,IAAI,CAAC;QACnC,IAAIA,IAAI,CAACG,IAAI,KAAK,aAAa,EAAE;UAC/BZ,QAAQ,CAACH,eAAe,CAAC;YACvBgB,MAAM,EAAEJ,IAAI,CAACI,MAAM;YACnBC,KAAK,EAAEL,IAAI,CAACK,KAAK;YACjBC,UAAU,EAAEN,IAAI,CAACM;UACnB,CAAC,CAAC,CAAC;QACL,CAAC,MAAM,IAAIN,IAAI,CAACG,IAAI,KAAK,gBAAgB,EAAE;UACzCZ,QAAQ,CAACJ,kBAAkB,CAAC;YAC1BiB,MAAM,EAAEJ,IAAI,CAACI,MAAM;YACnBG,QAAQ,EAAEP,IAAI,CAACO,QAAQ;YACvBC,aAAa,EAAER,IAAI,CAACQ;UACtB,CAAC,CAAC,CAAC;QACL;MACF,CAAC;MACDb,EAAE,CAACc,OAAO,GAAG,MAAM;QACjBC,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC;MAC5C,CAAC;MACDhB,EAAE,CAACiB,OAAO,GAAIC,KAAK,IAAK;QACtBH,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEE,KAAK,CAAC;MACxC,CAAC;MACDjB,KAAK,CAACD,EAAE,CAAC;IACX,CAAC;IAEDE,yBAAyB,CAAC,CAAC;IAE3B,OAAO,MAAM;MACX,IAAIF,EAAE,EAAE;QACNA,EAAE,CAACmB,KAAK,CAAC,CAAC;MACZ;IACF,CAAC;EACH,CAAC,EAAE,CAACvB,QAAQ,EAAEC,KAAK,CAAC,CAAC;EAErB,OAAOG,EAAE;AACX,CAAC;AAACL,EAAA,CA3CID,YAAY;EAAA,QACCL,WAAW,EACdC,WAAW;AAAA;AA2C3B,eAAeI,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}