{"ast":null,"code":"var _jsxFileName = \"H:\\\\SecondProject-DjangoReact\\\\frontend\\\\socialmedia-app\\\\src\\\\components\\\\UserListMessage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { fetchFollowers } from '../features/auth/followerSlice';\nimport { fetchUnreadCounts, updateUnreadCounts } from '../features/auth/chatSlice';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst UserList = ({\n  onUserSelect\n}) => {\n  _s();\n  const dispatch = useDispatch();\n  const [searchQuery, setSearchQuery] = useState('');\n  const followers = useSelector(state => state.followers.followers);\n  const loading = useSelector(state => state.followers.loading);\n  const error = useSelector(state => state.followers.error);\n  const user = useSelector(state => state.user.user);\n  const token = useSelector(state => state.auth.token);\n  const unreadCounts = useSelector(state => state.chat.unreadMessages);\n  useEffect(() => {\n    // Fetch followers when component loads\n    if (token) {\n      dispatch(fetchFollowers({\n        userId: user.id,\n        token,\n        followertype: 'following'\n      }));\n      //fetchUnreadCounts();\n      dispatch(fetchUnreadCounts({\n        token\n      }));\n    }\n  }, [token, user]);\n  useEffect(() => {\n    // Setup WebSocket connection for real-time unread counts\n    const wsUrl = `ws://localhost:8000/ws/chat/notification/`;\n    const notificationSocket = new WebSocket(wsUrl);\n    notificationSocket.onopen = () => {\n      console.log(\"WebSocket connected for notifications in userlist\");\n    };\n    notificationSocket.onmessage = event => {\n      const data = JSON.parse(event.data);\n      if (data.type === \"unread_counts\") {\n        // Dispatch an action to update the unread counts in the Redux store\n        dispatch(updateUnreadCounts(data.unread_counts));\n      }\n    };\n    notificationSocket.onclose = function (e) {\n      console.error(\"WebSocket closed unexpectedly. Reconnecting...\");\n      setTimeout(() => {\n        // Reconnect or provide logic to handle reconnection\n        connectWebSocket();\n      }, 3000); // Retry after 3 seconds\n    };\n\n    // Clean up the WebSocket connection when the component unmounts\n    return () => {\n      notificationSocket.close();\n    };\n  }, [dispatch]);\n\n  // Filter followers based on search input\n  const filteredFollowers = followers.filter(user => user.username.toLowerCase().includes(searchQuery.toLowerCase()));\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: \"Loading...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 23\n  }, this);\n  if (error) return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [\"Error: \", error]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 21\n  }, this);\n  const generateRoomName = userId => {\n    const currentUserId = user.id; // Assuming `user` is the logged-in user\n    const sortedIds = [currentUserId, userId].sort((a, b) => a - b); // Sort the IDs to avoid different order issues\n    return `room_${sortedIds[0]}_${sortedIds[1]}`; // Create a room name using both user IDs\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-full\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-2\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Search users...\",\n        className: \"w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\",\n        value: searchQuery,\n        onChange: e => setSearchQuery(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-2 max-h-96 overflow-y-auto\",\n      children: filteredFollowers.length > 0 ? filteredFollowers.map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center p-2 hover:bg-gray-100 cursor-pointer rounded-lg transition-colors duration-200 ease-in-out\",\n        onClick: () => onUserSelect(user, generateRoomName(user.id)),\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: user.profile_pic || 'https://via.placeholder.com/30',\n          alt: user.username,\n          className: \"w-6 h-6 rounded-full object-cover mr-3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"font-medium\",\n          children: user.username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 12\n        }, this), unreadCounts[user.id] > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-xs font-bold text-white bg-red-500 rounded-full w-5 h-5 flex items-center justify-center ml-2\",\n          children: unreadCounts[user.id]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 19\n        }, this)]\n      }, user.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 11\n      }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-gray-500 text-center p-4\",\n        children: \"No users found\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 5\n  }, this);\n};\n_s(UserList, \"l6JKnViZo47nBVWEaez0AgGVO6E=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n_c = UserList;\nexport default UserList;\nvar _c;\n$RefreshReg$(_c, \"UserList\");","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","fetchFollowers","fetchUnreadCounts","updateUnreadCounts","jsxDEV","_jsxDEV","UserList","onUserSelect","_s","dispatch","searchQuery","setSearchQuery","followers","state","loading","error","user","token","auth","unreadCounts","chat","unreadMessages","userId","id","followertype","wsUrl","notificationSocket","WebSocket","onopen","console","log","onmessage","event","data","JSON","parse","type","unread_counts","onclose","e","setTimeout","connectWebSocket","close","filteredFollowers","filter","username","toLowerCase","includes","children","fileName","_jsxFileName","lineNumber","columnNumber","generateRoomName","currentUserId","sortedIds","sort","a","b","className","placeholder","value","onChange","target","length","map","onClick","src","profile_pic","alt","_c","$RefreshReg$"],"sources":["H:/SecondProject-DjangoReact/frontend/socialmedia-app/src/components/UserListMessage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { fetchFollowers } from '../features/auth/followerSlice';\r\nimport { fetchUnreadCounts, updateUnreadCounts } from '../features/auth/chatSlice';\r\n\r\nconst UserList = ({ onUserSelect }) => {\r\n  const dispatch = useDispatch();\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const followers = useSelector((state) => state.followers.followers); \r\n  const loading = useSelector((state) => state.followers.loading); \r\n  const error = useSelector((state) => state.followers.error); \r\n  const user = useSelector((state) => state.user.user);\r\n  const token = useSelector((state) => state.auth.token);\r\n  const unreadCounts = useSelector((state) => state.chat.unreadMessages);\r\n\r\n  useEffect(() => {\r\n    // Fetch followers when component loads\r\n    if (token) {\r\n      dispatch(fetchFollowers({ userId:user.id, token,followertype:'following' }));\r\n      //fetchUnreadCounts();\r\n      dispatch(fetchUnreadCounts({token}))\r\n    }\r\n  }, [token,user]);\r\n\r\n  useEffect(() => {\r\n    // Setup WebSocket connection for real-time unread counts\r\n    const wsUrl = `ws://localhost:8000/ws/chat/notification/`;\r\n    const notificationSocket = new WebSocket(wsUrl);\r\n\r\n    notificationSocket.onopen = () => {\r\n      console.log(\"WebSocket connected for notifications in userlist\");\r\n    };\r\n\r\n    notificationSocket.onmessage = (event) => {\r\n      const data = JSON.parse(event.data);\r\n      if (data.type === \"unread_counts\") {\r\n        // Dispatch an action to update the unread counts in the Redux store\r\n        dispatch(updateUnreadCounts(data.unread_counts));\r\n      }\r\n    };\r\n\r\n    notificationSocket.onclose = function(e) {\r\n      console.error(\"WebSocket closed unexpectedly. Reconnecting...\");\r\n      setTimeout(() => {\r\n          // Reconnect or provide logic to handle reconnection\r\n          connectWebSocket();\r\n      }, 3000);  // Retry after 3 seconds\r\n  };\r\n\r\n    // Clean up the WebSocket connection when the component unmounts\r\n    return () => {\r\n      notificationSocket.close();\r\n    };\r\n  }, [dispatch]);\r\n\r\n  \r\n  // Filter followers based on search input\r\n  const filteredFollowers = followers.filter((user) =>\r\n    user.username.toLowerCase().includes(searchQuery.toLowerCase())\r\n  );\r\n\r\n  if (loading) return <div>Loading...</div>;\r\n  if (error) return <div>Error: {error}</div>;\r\n  const generateRoomName = (userId) => {\r\n    const currentUserId = user.id; // Assuming `user` is the logged-in user\r\n    const sortedIds = [currentUserId, userId].sort((a, b) => a - b); // Sort the IDs to avoid different order issues\r\n    return `room_${sortedIds[0]}_${sortedIds[1]}`; // Create a room name using both user IDs\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full\">\r\n    {/* Search Box */}\r\n    <div className=\"p-2\">\r\n      <input\r\n        type=\"text\"\r\n        placeholder=\"Search users...\"\r\n        className=\"w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n        value={searchQuery}\r\n        onChange={(e) => setSearchQuery(e.target.value)}\r\n      />\r\n    </div>\r\n\r\n    {/* User List */}\r\n    <div className=\"mt-2 max-h-96 overflow-y-auto\">\r\n      {filteredFollowers.length > 0 ? (\r\n        filteredFollowers.map((user) => (\r\n          <div\r\n            key={user.id}\r\n            className=\"flex items-center p-2 hover:bg-gray-100 cursor-pointer rounded-lg transition-colors duration-200 ease-in-out\"\r\n            onClick={() => onUserSelect(user, generateRoomName(user.id))}\r\n          >\r\n            <img\r\n              src={user.profile_pic || 'https://via.placeholder.com/30'}\r\n              alt={user.username}\r\n              className=\"w-6 h-6 rounded-full object-cover mr-3\"\r\n            />\r\n           <span className=\"font-medium\">{user.username}</span>\r\n                {unreadCounts[user.id] > 0 && (\r\n                  <span className=\"text-xs font-bold text-white bg-red-500 rounded-full w-5 h-5 flex items-center justify-center ml-2\">\r\n                    {unreadCounts[user.id]}\r\n                  </span>\r\n                )}\r\n          </div>\r\n        ))\r\n      ) : (\r\n        <div className=\"text-gray-500 text-center p-4\">No users found</div>\r\n      )}\r\n    </div>\r\n  </div>\r\n  );\r\n};\r\n\r\nexport default UserList;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}