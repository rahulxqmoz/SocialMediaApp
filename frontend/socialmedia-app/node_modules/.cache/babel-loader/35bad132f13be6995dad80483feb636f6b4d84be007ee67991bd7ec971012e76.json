{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from 'axios';\nimport { BASE_URL } from '../../config';\nimport { showSuccessToast } from '../../components/CustomToast';\nimport { showErrorToast } from '../../components/ErroToast';\n\n// Updated to accept page parameter\nexport const fetchFeed = createAsyncThunk('feed/fetchFeed', async ({\n  token,\n  page\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.get(`${BASE_URL}/api/interactions/feed/?page=${page}`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    return {\n      posts: response.data,\n      page\n    };\n  } catch (error) {\n    return rejectWithValue(error.response.data);\n  }\n});\nexport const updatePostLikes = createAsyncThunk('feed/updatePostLikes', async ({\n  postId,\n  token,\n  userId\n}, {\n  dispatch\n}) => {\n  const response = await axios.post(`${BASE_URL}/api/likes/`, {\n    post: postId\n  }, {\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${token}`\n    }\n  });\n  dispatch(fetchFeed({\n    token,\n    userId\n  }));\n  if (response.status === 201) {\n    showSuccessToast(\"Post Liked!\");\n    return {\n      postId,\n      liked: true\n    };\n  } else if (response.status === 204) {\n    showSuccessToast(\"Post Uniked!\");\n    return {\n      postId,\n      liked: false\n    };\n  } else {\n    throw new Error('Failed to like/unlike post');\n  }\n});\nexport const updatePostBookmarks = createAsyncThunk('feed/updatePostBookmarks', async ({\n  postId,\n  token,\n  isBookmarked\n}, {\n  dispatch\n}) => {\n  if (isBookmarked) {\n    // If already bookmarked, unbookmark the post\n    await axios.delete(`${BASE_URL}/api/bookmarks/${postId}`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    showSuccessToast(\"Post Unmarked!\");\n    return {\n      postId,\n      bookmarked: false\n    };\n  } else {\n    // If not bookmarked, bookmark the post\n    await axios.post(`${BASE_URL}/api/bookmarks/`, {\n      post: postId\n    }, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    showSuccessToast(\"Post Bookmarked!\");\n    return {\n      postId,\n      bookmarked: true\n    };\n  }\n});\nexport const reportPost = createAsyncThunk('feed/reportPost', async ({\n  post,\n  reason,\n  additional_info,\n  reported_by,\n  token\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.post(`${BASE_URL}/api/reports/`, {\n      post,\n      reason,\n      additional_info,\n      reported_by\n    }, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    showSuccessToast('Post Reported!!');\n    return response.data;\n  } catch (error) {\n    showErrorToast('Error occured in submitting!');\n    console.log(error.response.data);\n    return rejectWithValue(error.response.data);\n  }\n});\nconst feedSlice = createSlice({\n  name: 'feed',\n  initialState: {\n    posts: [],\n    loading: false,\n    error: null,\n    hasMore: true\n  },\n  reducers: {},\n  extraReducers: builder => {\n    builder.addCase(fetchFeed.pending, state => {\n      state.loading = true;\n      state.error = null;\n    }).addCase(fetchFeed.fulfilled, (state, action) => {\n      const {\n        posts,\n        page\n      } = action.payload;\n      state.loading = false;\n      state.error = null;\n      if (page === 1) {\n        // Replace posts if it's the first page\n        state.posts = posts;\n      } else {\n        // Append posts for subsequent pages\n        state.posts = [...state.posts, ...posts];\n      }\n\n      // Determine if there are more posts to load\n      state.hasMore = posts.length > 0;\n    }).addCase(fetchFeed.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload.message;\n    }).addCase(updatePostLikes.fulfilled, (state, action) => {\n      const postIndex = state.posts.findIndex(post => post.id === action.payload.postId);\n      if (postIndex !== -1) {\n        state.posts[postIndex].liked = action.payload.liked;\n        state.posts[postIndex].total_likes += action.payload.liked ? 1 : -1;\n      }\n    }).addCase(updatePostBookmarks.fulfilled, (state, action) => {\n      const postIndex = state.posts.findIndex(post => post.id === action.payload.postId);\n      if (postIndex !== -1) {\n        state.posts[postIndex].bookmarked = action.payload.bookmarked;\n      }\n    }).addCase(reportPost.pending, state => {\n      state.loading = true;\n    }).addCase(reportPost.fulfilled, (state, action) => {\n      state.loading = false;\n      // Handle successful report (e.g., show a success message, update state if needed)\n    }).addCase(reportPost.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.payload;\n      if (action.payload.non_field_errors) {\n        showErrorToast(action.payload.non_field_errors[0]);\n      } else if (action.payload.detail) {\n        showErrorToast(action.payload.detail);\n      } else if (action.payload.error) {\n        showErrorToast(action.payload.error);\n      } else {\n        showErrorToast('Error occured in submitting!');\n      }\n    });\n  }\n});\nexport default feedSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","BASE_URL","showSuccessToast","showErrorToast","fetchFeed","token","page","rejectWithValue","response","get","headers","Authorization","posts","data","error","updatePostLikes","postId","userId","dispatch","post","status","liked","Error","updatePostBookmarks","isBookmarked","delete","bookmarked","reportPost","reason","additional_info","reported_by","console","log","feedSlice","name","initialState","loading","hasMore","reducers","extraReducers","builder","addCase","pending","state","fulfilled","action","payload","length","rejected","message","postIndex","findIndex","id","total_likes","non_field_errors","detail","reducer"],"sources":["H:/SecondProject-DjangoReact/frontend/socialmedia-app/src/features/auth/feedSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit'; \r\nimport axios from 'axios';\r\nimport { BASE_URL } from '../../config';\r\nimport { showSuccessToast } from '../../components/CustomToast';\r\nimport { showErrorToast } from '../../components/ErroToast';\r\n\r\n// Updated to accept page parameter\r\nexport const fetchFeed = createAsyncThunk(\r\n  'feed/fetchFeed',\r\n  async ({ token, page }, { rejectWithValue }) => {\r\n    try {\r\n      const response = await axios.get(`${BASE_URL}/api/interactions/feed/?page=${page}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n      return { posts: response.data, page };\r\n    } catch (error) {\r\n      return rejectWithValue(error.response.data);\r\n    }\r\n  }\r\n);\r\n\r\nexport const updatePostLikes = createAsyncThunk(\r\n  'feed/updatePostLikes',\r\n  async ({ postId, token, userId }, { dispatch }) => {\r\n    const response = await axios.post(`${BASE_URL}/api/likes/`, {\r\n      post: postId,\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n    dispatch(fetchFeed({ token, userId }));\r\n    if (response.status === 201) {\r\n      showSuccessToast(\"Post Liked!\");\r\n      return { postId, liked: true };\r\n    } else if (response.status === 204) {\r\n      showSuccessToast(\"Post Uniked!\");\r\n      return { postId, liked: false };\r\n    } else {\r\n      throw new Error('Failed to like/unlike post');\r\n    }\r\n  }\r\n);\r\n\r\nexport const updatePostBookmarks = createAsyncThunk(\r\n  'feed/updatePostBookmarks',\r\n  async ({ postId, token, isBookmarked }, { dispatch }) => {\r\n    if (isBookmarked) {\r\n      // If already bookmarked, unbookmark the post\r\n      await axios.delete(`${BASE_URL}/api/bookmarks/${postId}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n      showSuccessToast(\"Post Unmarked!\");\r\n      return { postId, bookmarked: false };\r\n    } else {\r\n      // If not bookmarked, bookmark the post\r\n      await axios.post(`${BASE_URL}/api/bookmarks/`, { post: postId }, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n      showSuccessToast(\"Post Bookmarked!\");\r\n      return { postId, bookmarked: true };\r\n    }\r\n  }\r\n);\r\nexport const reportPost = createAsyncThunk(\r\n  'feed/reportPost',\r\n  async ({ post, reason, additional_info, reported_by,token }, { rejectWithValue }) => {\r\n    try {\r\n      const response = await axios.post(\r\n        `${BASE_URL}/api/reports/`,\r\n        {\r\n          post,\r\n          reason,          \r\n          additional_info,  \r\n          reported_by\r\n        },\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n        }\r\n      );\r\n      showSuccessToast('Post Reported!!')\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      showErrorToast('Error occured in submitting!')\r\n      console.log(error.response.data);\r\n      return rejectWithValue(error.response.data);\r\n    }\r\n  }\r\n);\r\nconst feedSlice = createSlice({\r\n  name: 'feed',\r\n  initialState: {\r\n    posts: [],\r\n    loading: false,\r\n    error: null,\r\n    hasMore: true,\r\n  },\r\n  reducers: {},\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(fetchFeed.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchFeed.fulfilled, (state, action) => {\r\n        const { posts, page } = action.payload;\r\n        state.loading = false;\r\n        state.error = null;\r\n\r\n        if (page === 1) {\r\n          // Replace posts if it's the first page\r\n          state.posts = posts;\r\n        } else {\r\n          // Append posts for subsequent pages\r\n          state.posts = [...state.posts, ...posts];\r\n        }\r\n\r\n        // Determine if there are more posts to load\r\n        state.hasMore = posts.length > 0;\r\n      })\r\n      .addCase(fetchFeed.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload.message;\r\n      })\r\n      .addCase(updatePostLikes.fulfilled, (state, action) => {\r\n        const postIndex = state.posts.findIndex(post => post.id === action.payload.postId);\r\n        if (postIndex !== -1) {\r\n          state.posts[postIndex].liked = action.payload.liked;\r\n          state.posts[postIndex].total_likes += action.payload.liked ? 1 : -1;\r\n        }\r\n      })\r\n      .addCase(updatePostBookmarks.fulfilled, (state, action) => {\r\n        const postIndex = state.posts.findIndex(post => post.id === action.payload.postId);\r\n        if (postIndex !== -1) {\r\n          state.posts[postIndex].bookmarked = action.payload.bookmarked;\r\n        }\r\n      })\r\n      .addCase(reportPost.pending, (state) => {\r\n        state.loading = true;\r\n      })\r\n      .addCase(reportPost.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        // Handle successful report (e.g., show a success message, update state if needed)\r\n      })\r\n      .addCase(reportPost.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload;\r\n        if (action.payload.non_field_errors) {\r\n          showErrorToast(action.payload.non_field_errors[0]);\r\n        } else if (action.payload.detail) {\r\n          showErrorToast(action.payload.detail);\r\n        } else if (action.payload.error) {\r\n          showErrorToast(action.payload.error);\r\n        } else {\r\n          showErrorToast('Error occured in submitting!');\r\n        }\r\n      });\r\n  },\r\n});\r\n\r\n\r\n\r\n\r\nexport default feedSlice.reducer;\r\n"],"mappings":"AAAA,SAASA,WAAW,EAAEC,gBAAgB,QAAQ,kBAAkB;AAChE,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,QAAQ,cAAc;AACvC,SAASC,gBAAgB,QAAQ,8BAA8B;AAC/D,SAASC,cAAc,QAAQ,4BAA4B;;AAE3D;AACA,OAAO,MAAMC,SAAS,GAAGL,gBAAgB,CACvC,gBAAgB,EAChB,OAAO;EAAEM,KAAK;EAAEC;AAAK,CAAC,EAAE;EAAEC;AAAgB,CAAC,KAAK;EAC9C,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMR,KAAK,CAACS,GAAG,CAAC,GAAGR,QAAQ,gCAAgCK,IAAI,EAAE,EAAE;MAClFI,OAAO,EAAE;QACPC,aAAa,EAAE,UAAUN,KAAK;MAChC;IACF,CAAC,CAAC;IACF,OAAO;MAAEO,KAAK,EAAEJ,QAAQ,CAACK,IAAI;MAAEP;IAAK,CAAC;EACvC,CAAC,CAAC,OAAOQ,KAAK,EAAE;IACd,OAAOP,eAAe,CAACO,KAAK,CAACN,QAAQ,CAACK,IAAI,CAAC;EAC7C;AACF,CACF,CAAC;AAED,OAAO,MAAME,eAAe,GAAGhB,gBAAgB,CAC7C,sBAAsB,EACtB,OAAO;EAAEiB,MAAM;EAAEX,KAAK;EAAEY;AAAO,CAAC,EAAE;EAAEC;AAAS,CAAC,KAAK;EACjD,MAAMV,QAAQ,GAAG,MAAMR,KAAK,CAACmB,IAAI,CAAC,GAAGlB,QAAQ,aAAa,EAAE;IAC1DkB,IAAI,EAAEH;EACR,CAAC,EAAE;IACDN,OAAO,EAAE;MACP,cAAc,EAAE,kBAAkB;MAClCC,aAAa,EAAE,UAAUN,KAAK;IAChC;EACF,CAAC,CAAC;EACFa,QAAQ,CAACd,SAAS,CAAC;IAAEC,KAAK;IAAEY;EAAO,CAAC,CAAC,CAAC;EACtC,IAAIT,QAAQ,CAACY,MAAM,KAAK,GAAG,EAAE;IAC3BlB,gBAAgB,CAAC,aAAa,CAAC;IAC/B,OAAO;MAAEc,MAAM;MAAEK,KAAK,EAAE;IAAK,CAAC;EAChC,CAAC,MAAM,IAAIb,QAAQ,CAACY,MAAM,KAAK,GAAG,EAAE;IAClClB,gBAAgB,CAAC,cAAc,CAAC;IAChC,OAAO;MAAEc,MAAM;MAAEK,KAAK,EAAE;IAAM,CAAC;EACjC,CAAC,MAAM;IACL,MAAM,IAAIC,KAAK,CAAC,4BAA4B,CAAC;EAC/C;AACF,CACF,CAAC;AAED,OAAO,MAAMC,mBAAmB,GAAGxB,gBAAgB,CACjD,0BAA0B,EAC1B,OAAO;EAAEiB,MAAM;EAAEX,KAAK;EAAEmB;AAAa,CAAC,EAAE;EAAEN;AAAS,CAAC,KAAK;EACvD,IAAIM,YAAY,EAAE;IAChB;IACA,MAAMxB,KAAK,CAACyB,MAAM,CAAC,GAAGxB,QAAQ,kBAAkBe,MAAM,EAAE,EAAE;MACxDN,OAAO,EAAE;QACPC,aAAa,EAAE,UAAUN,KAAK;MAChC;IACF,CAAC,CAAC;IACFH,gBAAgB,CAAC,gBAAgB,CAAC;IAClC,OAAO;MAAEc,MAAM;MAAEU,UAAU,EAAE;IAAM,CAAC;EACtC,CAAC,MAAM;IACL;IACA,MAAM1B,KAAK,CAACmB,IAAI,CAAC,GAAGlB,QAAQ,iBAAiB,EAAE;MAAEkB,IAAI,EAAEH;IAAO,CAAC,EAAE;MAC/DN,OAAO,EAAE;QACPC,aAAa,EAAE,UAAUN,KAAK;MAChC;IACF,CAAC,CAAC;IACFH,gBAAgB,CAAC,kBAAkB,CAAC;IACpC,OAAO;MAAEc,MAAM;MAAEU,UAAU,EAAE;IAAK,CAAC;EACrC;AACF,CACF,CAAC;AACD,OAAO,MAAMC,UAAU,GAAG5B,gBAAgB,CACxC,iBAAiB,EACjB,OAAO;EAAEoB,IAAI;EAAES,MAAM;EAAEC,eAAe;EAAEC,WAAW;EAACzB;AAAM,CAAC,EAAE;EAAEE;AAAgB,CAAC,KAAK;EACnF,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAMR,KAAK,CAACmB,IAAI,CAC/B,GAAGlB,QAAQ,eAAe,EAC1B;MACEkB,IAAI;MACJS,MAAM;MACNC,eAAe;MACfC;IACF,CAAC,EACD;MACEpB,OAAO,EAAE;QACPC,aAAa,EAAE,UAAUN,KAAK;MAChC;IACF,CACF,CAAC;IACDH,gBAAgB,CAAC,iBAAiB,CAAC;IACnC,OAAOM,QAAQ,CAACK,IAAI;EAEtB,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdX,cAAc,CAAC,8BAA8B,CAAC;IAC9C4B,OAAO,CAACC,GAAG,CAAClB,KAAK,CAACN,QAAQ,CAACK,IAAI,CAAC;IAChC,OAAON,eAAe,CAACO,KAAK,CAACN,QAAQ,CAACK,IAAI,CAAC;EAC7C;AACF,CACF,CAAC;AACD,MAAMoB,SAAS,GAAGnC,WAAW,CAAC;EAC5BoC,IAAI,EAAE,MAAM;EACZC,YAAY,EAAE;IACZvB,KAAK,EAAE,EAAE;IACTwB,OAAO,EAAE,KAAK;IACdtB,KAAK,EAAE,IAAI;IACXuB,OAAO,EAAE;EACX,CAAC;EACDC,QAAQ,EAAE,CAAC,CAAC;EACZC,aAAa,EAAGC,OAAO,IAAK;IAC1BA,OAAO,CACJC,OAAO,CAACrC,SAAS,CAACsC,OAAO,EAAGC,KAAK,IAAK;MACrCA,KAAK,CAACP,OAAO,GAAG,IAAI;MACpBO,KAAK,CAAC7B,KAAK,GAAG,IAAI;IACpB,CAAC,CAAC,CACD2B,OAAO,CAACrC,SAAS,CAACwC,SAAS,EAAE,CAACD,KAAK,EAAEE,MAAM,KAAK;MAC/C,MAAM;QAAEjC,KAAK;QAAEN;MAAK,CAAC,GAAGuC,MAAM,CAACC,OAAO;MACtCH,KAAK,CAACP,OAAO,GAAG,KAAK;MACrBO,KAAK,CAAC7B,KAAK,GAAG,IAAI;MAElB,IAAIR,IAAI,KAAK,CAAC,EAAE;QACd;QACAqC,KAAK,CAAC/B,KAAK,GAAGA,KAAK;MACrB,CAAC,MAAM;QACL;QACA+B,KAAK,CAAC/B,KAAK,GAAG,CAAC,GAAG+B,KAAK,CAAC/B,KAAK,EAAE,GAAGA,KAAK,CAAC;MAC1C;;MAEA;MACA+B,KAAK,CAACN,OAAO,GAAGzB,KAAK,CAACmC,MAAM,GAAG,CAAC;IAClC,CAAC,CAAC,CACDN,OAAO,CAACrC,SAAS,CAAC4C,QAAQ,EAAE,CAACL,KAAK,EAAEE,MAAM,KAAK;MAC9CF,KAAK,CAACP,OAAO,GAAG,KAAK;MACrBO,KAAK,CAAC7B,KAAK,GAAG+B,MAAM,CAACC,OAAO,CAACG,OAAO;IACtC,CAAC,CAAC,CACDR,OAAO,CAAC1B,eAAe,CAAC6B,SAAS,EAAE,CAACD,KAAK,EAAEE,MAAM,KAAK;MACrD,MAAMK,SAAS,GAAGP,KAAK,CAAC/B,KAAK,CAACuC,SAAS,CAAChC,IAAI,IAAIA,IAAI,CAACiC,EAAE,KAAKP,MAAM,CAACC,OAAO,CAAC9B,MAAM,CAAC;MAClF,IAAIkC,SAAS,KAAK,CAAC,CAAC,EAAE;QACpBP,KAAK,CAAC/B,KAAK,CAACsC,SAAS,CAAC,CAAC7B,KAAK,GAAGwB,MAAM,CAACC,OAAO,CAACzB,KAAK;QACnDsB,KAAK,CAAC/B,KAAK,CAACsC,SAAS,CAAC,CAACG,WAAW,IAAIR,MAAM,CAACC,OAAO,CAACzB,KAAK,GAAG,CAAC,GAAG,CAAC,CAAC;MACrE;IACF,CAAC,CAAC,CACDoB,OAAO,CAAClB,mBAAmB,CAACqB,SAAS,EAAE,CAACD,KAAK,EAAEE,MAAM,KAAK;MACzD,MAAMK,SAAS,GAAGP,KAAK,CAAC/B,KAAK,CAACuC,SAAS,CAAChC,IAAI,IAAIA,IAAI,CAACiC,EAAE,KAAKP,MAAM,CAACC,OAAO,CAAC9B,MAAM,CAAC;MAClF,IAAIkC,SAAS,KAAK,CAAC,CAAC,EAAE;QACpBP,KAAK,CAAC/B,KAAK,CAACsC,SAAS,CAAC,CAACxB,UAAU,GAAGmB,MAAM,CAACC,OAAO,CAACpB,UAAU;MAC/D;IACF,CAAC,CAAC,CACDe,OAAO,CAACd,UAAU,CAACe,OAAO,EAAGC,KAAK,IAAK;MACtCA,KAAK,CAACP,OAAO,GAAG,IAAI;IACtB,CAAC,CAAC,CACDK,OAAO,CAACd,UAAU,CAACiB,SAAS,EAAE,CAACD,KAAK,EAAEE,MAAM,KAAK;MAChDF,KAAK,CAACP,OAAO,GAAG,KAAK;MACrB;IACF,CAAC,CAAC,CACDK,OAAO,CAACd,UAAU,CAACqB,QAAQ,EAAE,CAACL,KAAK,EAAEE,MAAM,KAAK;MAC/CF,KAAK,CAACP,OAAO,GAAG,KAAK;MACrBO,KAAK,CAAC7B,KAAK,GAAG+B,MAAM,CAACC,OAAO;MAC5B,IAAID,MAAM,CAACC,OAAO,CAACQ,gBAAgB,EAAE;QACnCnD,cAAc,CAAC0C,MAAM,CAACC,OAAO,CAACQ,gBAAgB,CAAC,CAAC,CAAC,CAAC;MACpD,CAAC,MAAM,IAAIT,MAAM,CAACC,OAAO,CAACS,MAAM,EAAE;QAChCpD,cAAc,CAAC0C,MAAM,CAACC,OAAO,CAACS,MAAM,CAAC;MACvC,CAAC,MAAM,IAAIV,MAAM,CAACC,OAAO,CAAChC,KAAK,EAAE;QAC/BX,cAAc,CAAC0C,MAAM,CAACC,OAAO,CAAChC,KAAK,CAAC;MACtC,CAAC,MAAM;QACLX,cAAc,CAAC,8BAA8B,CAAC;MAChD;IACF,CAAC,CAAC;EACN;AACF,CAAC,CAAC;AAKF,eAAe8B,SAAS,CAACuB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}